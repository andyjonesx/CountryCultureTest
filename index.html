<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What Country Are You?</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ============ RESET & BASE ============ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --color-bg: #FFF8F0;
  --color-bg-card: #FFFFFF;
  --color-primary: #E07A5F;
  --color-primary-dark: #C56A52;
  --color-secondary: #3D405B;
  --color-accent: #81B29A;
  --color-accent-light: #F2CC8F;
  --color-text: #2D2D2D;
  --color-text-muted: #6B7280;
  --color-low: #81B29A;
  --color-high: #E07A5F;
  --color-border: #E5E7EB;
  --font-heading: 'DM Serif Display', Georgia, serif;
  --font-body: 'Inter', -apple-system, sans-serif;
  --max-width: 860px;
  --radius: 12px;
  --radius-sm: 8px;
  --transition-fast: 200ms ease;
  --transition-normal: 400ms ease;
  --transition-slow: 600ms cubic-bezier(0.22, 1, 0.36, 1);
}

html { scroll-behavior: smooth; }

body {
  font-family: var(--font-body);
  background: var(--color-bg);
  color: var(--color-text);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

h1, h2, h3 { font-family: var(--font-heading); font-weight: 400; }
h1 { font-size: 2.8rem; line-height: 1.15; color: var(--color-secondary); }
h2 { font-size: 1.8rem; line-height: 1.3; color: var(--color-secondary); }
h3 { font-size: 1.3rem; color: var(--color-secondary); }

/* ============ PROGRESS BAR ============ */
#progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  opacity: 0;
  transition: opacity var(--transition-normal);
  pointer-events: none;
}
#progress-bar.visible { opacity: 1; }

#progress-fill {
  height: 4px;
  background: linear-gradient(90deg, var(--color-accent), var(--color-primary));
  border-radius: 0 2px 2px 0;
  transition: width var(--transition-slow);
  width: 0%;
}

#progress-dots {
  display: flex;
  justify-content: center;
  gap: 12px;
  padding: 12px 0;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--color-border);
  transition: all var(--transition-fast);
}
.dot.active { background: var(--color-primary); transform: scale(1.3); }
.dot.completed { background: var(--color-accent); }

/* ============ SCREENS ============ */
.screen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  opacity: 0;
  transform: translateX(60px);
  pointer-events: none;
  transition: opacity var(--transition-slow), transform var(--transition-slow);
  overflow-y: auto;
  padding: 40px 20px 60px;
}

.screen.welcome-screen {
  align-items: center;
  padding-top: 20px;
}

.screen.active {
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}

.screen.exit-left {
  opacity: 0;
  transform: translateX(-60px);
}

.screen.exit-right {
  opacity: 0;
  transform: translateX(60px);
}

.screen-content {
  width: 100%;
  max-width: var(--max-width);
  margin: 0 auto;
}

/* ============ WELCOME SCREEN ============ */
.welcome-content { text-align: center; padding: 20px 0; }
.welcome-content h1 { margin-bottom: 16px; }

.welcome-subtitle {
  font-size: 1.1rem;
  color: var(--color-text-muted);
  margin-bottom: 32px;
  line-height: 1.6;
}

.welcome-features {
  display: flex;
  gap: 16px;
  margin-bottom: 32px;
  text-align: left;
}

.welcome-feature {
  flex: 1;
  background: var(--color-bg-card);
  border-radius: var(--radius);
  padding: 20px;
  border: 1px solid var(--color-border);
}

.welcome-feature .feature-icon { font-size: 1.5rem; margin-bottom: 8px; }
.welcome-feature .feature-title { font-weight: 600; font-size: 0.85rem; margin-bottom: 4px; }
.welcome-feature .feature-desc { font-size: 0.8rem; color: var(--color-text-muted); line-height: 1.4; }

.name-input-section {
  margin-bottom: 28px;
}

.name-input {
  padding: 14px 20px;
  border: 2px solid var(--color-border);
  border-radius: 50px;
  font-family: var(--font-body);
  font-size: 1rem;
  width: 280px;
  max-width: 100%;
  text-align: center;
  background: var(--color-bg-card);
  color: var(--color-text);
  transition: border-color var(--transition-fast);
}

.name-input:focus { outline: none; border-color: var(--color-primary); }
.name-input::placeholder { color: #B0B0B0; }
.name-input.error { border-color: var(--color-primary); animation: shake 400ms ease; }
.name-error { color: var(--color-primary); font-size: 0.82rem; margin-top: 8px; min-height: 1.2em; }

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-6px); }
  40%, 80% { transform: translateX(6px); }
}

/* ============ BUTTONS ============ */
.btn-primary {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 36px;
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: 50px;
  font-family: var(--font-body);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
  box-shadow: 0 4px 14px rgba(224, 122, 95, 0.3);
}

.btn-primary:hover {
  background: var(--color-primary-dark);
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(224, 122, 95, 0.4);
}

.btn-primary:active { transform: translateY(0); }

.btn-secondary {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 28px;
  background: transparent;
  color: var(--color-text-muted);
  border: 2px solid var(--color-border);
  border-radius: 50px;
  font-family: var(--font-body);
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.btn-secondary:hover {
  border-color: var(--color-secondary);
  color: var(--color-secondary);
}

.btn-small {
  padding: 8px 18px;
  font-size: 0.82rem;
  border-radius: 50px;
  border: 1px solid var(--color-border);
  background: var(--color-bg-card);
  color: var(--color-text-muted);
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 500;
  transition: all var(--transition-fast);
}

.btn-small:hover { border-color: var(--color-primary); color: var(--color-primary); }

.nav-buttons {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 32px;
}

/* ============ DIMENSION SCREENS ============ */
.dim-screen { padding-top: 56px; }

.dim-number {
  display: inline-block;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-primary);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 8px;
}

.dim-title { margin-bottom: 8px; }

.dim-question {
  font-size: 1.05rem;
  color: var(--color-text-muted);
  margin-bottom: 24px;
  line-height: 1.5;
}

/* Spectrum display */
.spectrum-container {
  background: var(--color-bg-card);
  border-radius: var(--radius);
  border: 1px solid var(--color-border);
  padding: 20px;
  margin-bottom: 28px;
}

.spectrum-labels {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}

.spectrum-label-left {
  font-weight: 700;
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 3px 10px;
  border-radius: 20px;
  background: #E8F5EE;
  color: #3D8B63;
}

.spectrum-label-right {
  font-weight: 700;
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 3px 10px;
  border-radius: 20px;
  background: #FDE8E2;
  color: #C56A52;
}

.spectrum-points {
  display: flex;
  gap: 0;
}

.spectrum-point {
  flex: 1;
  padding: 10px 10px;
  font-size: 0.8rem;
  line-height: 1.45;
  color: var(--color-text-muted);
  border-left: 2px solid var(--color-border);
  position: relative;
}

.spectrum-point:first-child { border-left: none; }

.spectrum-point .sp-marker {
  font-size: 0.65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--color-text-muted);
  margin-bottom: 4px;
  display: block;
  opacity: 0.6;
}

.spectrum-point .sp-text {
  color: var(--color-text);
  font-size: 0.8rem;
  line-height: 1.6;
  white-space: pre-line;
}

/* ============ SLIDER ============ */
.slider-container {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 8px 0;
}

.slider-label {
  font-size: 0.72rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  min-width: 70px;
}

.slider-label-left { color: var(--color-low); text-align: right; }
.slider-label-right { color: var(--color-high); text-align: left; }

/* Importance toggle */
.importance-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 14px;
  font-size: 0.78rem;
  color: var(--color-text-muted);
}

.importance-toggle span { white-space: nowrap; }

.importance-btns {
  display: inline-flex;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  overflow: hidden;
}

.imp-btn {
  padding: 5px 12px;
  border: none;
  background: var(--color-bg-card);
  color: var(--color-text-muted);
  font-family: var(--font-body);
  font-size: 0.72rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
  border-right: 1px solid var(--color-border);
}

.imp-btn:last-child { border-right: none; }
.imp-btn:hover { background: #F3F4F6; }
.imp-btn.active { background: var(--color-secondary); color: white; }
.imp-btn.active:hover { background: var(--color-secondary); }

.custom-slider {
  -webkit-appearance: none;
  appearance: none;
  flex: 1;
  height: 10px;
  border-radius: 5px;
  outline: none;
  cursor: pointer;
  background: linear-gradient(
    to right,
    var(--color-accent) 0%,
    var(--color-accent) var(--val, 50%),
    var(--color-border) var(--val, 50%),
    var(--color-border) 100%
  );
  transition: opacity var(--transition-fast);
}

.custom-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: var(--color-bg-card);
  border: 3px solid var(--color-primary);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  cursor: grab;
  transition: transform 150ms ease, box-shadow 150ms ease;
}

.custom-slider::-webkit-slider-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}

.custom-slider::-webkit-slider-thumb:active {
  cursor: grabbing;
  transform: scale(1.1);
  border-color: var(--color-primary-dark);
}

.custom-slider::-moz-range-thumb {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: var(--color-bg-card);
  border: 3px solid var(--color-primary);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  cursor: grab;
}

.custom-slider::-moz-range-track {
  height: 10px;
  border-radius: 5px;
  background: var(--color-border);
}

/* ============ RESULTS SCREEN ============ */
#screen-results { align-items: flex-start; padding-top: 30px; }
#screen-results .screen-content { max-width: 860px; padding-bottom: 60px; }

/* Loading animation */
.loading-overlay {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
  min-height: 400px;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.loading-text {
  font-size: 1.1rem;
  color: var(--color-text-muted);
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

/* Top match card */
.top-match {
  text-align: center;
  padding: 36px 30px;
  background: var(--color-bg-card);
  border-radius: 20px;
  border: 2px solid var(--color-accent-light);
  margin-bottom: 24px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.06);
}

.top-match .result-label {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--color-primary);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 12px;
}

.top-match .flag { font-size: 5rem; line-height: 1; margin-bottom: 8px; display: block; }
.top-match .country-name { font-size: 2.2rem; margin-bottom: 4px; }

.top-match .match-pct {
  display: inline-block;
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-accent);
  background: #E8F5EE;
  padding: 4px 14px;
  border-radius: 20px;
  margin-bottom: 16px;
}

.top-match .match-explanation {
  font-size: 0.92rem;
  line-height: 1.7;
  color: var(--color-text-muted);
  max-width: 520px;
  margin: 0 auto;
}

/* Reveal animations */
@keyframes revealUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes flagBounce {
  0% { transform: scale(0); }
  60% { transform: scale(1.15); }
  80% { transform: scale(0.95); }
  100% { transform: scale(1); }
}

.reveal { animation: revealUp 700ms cubic-bezier(0.22, 1, 0.36, 1) both; }
.reveal-delay-1 { animation-delay: 150ms; }
.reveal-delay-2 { animation-delay: 300ms; }
.reveal-delay-3 { animation-delay: 450ms; }
.flag-bounce { animation: flagBounce 600ms cubic-bezier(0.22, 1, 0.36, 1) both; animation-delay: 200ms; }

/* Sections */
.result-section {
  background: var(--color-bg-card);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 20px;
  border: 1px solid var(--color-border);
}

.result-section h3 { margin-bottom: 12px; font-size: 1.1rem; }

/* Home country selector */
.home-select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 0.95rem;
  background: var(--color-bg);
  color: var(--color-text);
  cursor: pointer;
  transition: border-color var(--transition-fast);
}

.home-select:focus { outline: none; border-color: var(--color-primary); }

/* Country list */
.country-list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.country-list-header h3 { margin: 0; }

.country-search {
  padding: 8px 14px;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 0.85rem;
  width: 200px;
  transition: border-color var(--transition-fast);
}

.country-search:focus { outline: none; border-color: var(--color-primary); }

.country-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-height: 480px;
  overflow-y: auto;
  padding-right: 8px;
}

.country-list::-webkit-scrollbar { width: 6px; }
.country-list::-webkit-scrollbar-track { background: transparent; }
.country-list::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 3px; }

.country-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  background: var(--color-bg);
  border-radius: var(--radius-sm);
  border: 1px solid transparent;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.country-item:hover {
  border-color: var(--color-primary);
  background: var(--color-bg-card);
  transform: translateX(4px);
}

.country-item.is-top { background: #FFFDF8; border-color: var(--color-accent-light); }

.country-item .ci-flag { font-size: 1.2rem; min-width: 26px; text-align: center; }
.country-item .ci-name { flex: 1; font-weight: 500; font-size: 0.88rem; }
.country-item .ci-rank { font-size: 0.72rem; color: var(--color-text-muted); font-weight: 600; min-width: 24px; }

.country-item .ci-pct {
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--color-accent);
  min-width: 44px;
  text-align: right;
}

.country-item .ci-arrow {
  color: var(--color-border);
  font-size: 1rem;
  transition: color var(--transition-fast);
}

.country-item:hover .ci-arrow { color: var(--color-primary); }

/* Share section */
.share-section { margin-bottom: 20px; }

.share-code-box {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.share-code {
  flex: 1;
  padding: 10px 14px;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: monospace;
  font-size: 0.85rem;
  background: var(--color-bg);
  color: var(--color-text);
  cursor: text;
}

.share-code:focus { outline: none; border-color: var(--color-primary); }

.btn-copy {
  padding: 10px 18px;
  border: 2px solid var(--color-accent);
  border-radius: var(--radius-sm);
  background: var(--color-accent);
  color: white;
  font-family: var(--font-body);
  font-weight: 600;
  font-size: 0.82rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  white-space: nowrap;
}

.btn-copy:hover { opacity: 0.9; }
.btn-copy.copied { background: var(--color-secondary); border-color: var(--color-secondary); }

.compare-input-box {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid var(--color-border);
}

.compare-input-box label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--color-secondary);
  margin-bottom: 8px;
}

.compare-input-row {
  display: flex;
  gap: 8px;
}

.compare-input {
  flex: 1;
  padding: 10px 14px;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: monospace;
  font-size: 0.85rem;
  background: var(--color-bg-card);
}

.compare-input:focus { outline: none; border-color: var(--color-primary); }

.btn-compare {
  padding: 10px 18px;
  border: 2px solid var(--color-primary);
  border-radius: var(--radius-sm);
  background: var(--color-primary);
  color: white;
  font-family: var(--font-body);
  font-weight: 600;
  font-size: 0.82rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  white-space: nowrap;
}

.btn-compare:hover { opacity: 0.9; }

/* Saved results */
.saved-list { display: flex; flex-direction: column; gap: 6px; }

.saved-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  background: var(--color-bg);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.saved-item:hover { background: #FDE8E2; }

.saved-item .si-name { flex: 1; font-weight: 600; font-size: 0.88rem; }
.saved-item .si-match { font-size: 0.82rem; color: var(--color-accent); font-weight: 500; }
.saved-item .si-date { font-size: 0.72rem; color: var(--color-text-muted); }
.saved-item .si-arrow { color: var(--color-border); }

.saved-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.saved-header h3 { margin: 0; }

/* ============ DETAIL MODAL ============ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 300ms ease;
  padding: 20px;
}

.modal-overlay.open { opacity: 1; pointer-events: auto; }

.modal {
  background: var(--color-bg);
  border-radius: 20px;
  width: 100%;
  max-width: 760px;
  max-height: 85vh;
  overflow-y: auto;
  transform: translateY(30px) scale(0.96);
  transition: transform 400ms cubic-bezier(0.22, 1, 0.36, 1);
  box-shadow: 0 20px 60px rgba(0,0,0,0.15);
}

.modal-overlay.open .modal { transform: translateY(0) scale(1); }

.modal-header {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 28px 28px 0 28px;
  position: sticky;
  top: 0;
  background: var(--color-bg);
  z-index: 1;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--color-border);
}

.modal-header .modal-flag { font-size: 2.6rem; }
.modal-header .modal-info { flex: 1; }
.modal-header .modal-info h2 { font-size: 1.5rem; margin-bottom: 2px; }
.modal-header .modal-pct { font-size: 0.85rem; font-weight: 600; color: var(--color-accent); }

.modal-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: var(--color-border);
  color: var(--color-text-muted);
  font-size: 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--transition-fast);
  flex-shrink: 0;
}

.modal-close:hover { background: var(--color-secondary); color: white; }

.modal-body { padding: 20px 28px 28px 28px; }

/* Comparison bars */
.comparison-section { margin-bottom: 24px; }
.comparison-section h3 { margin-bottom: 16px; font-size: 1.05rem; }

.comp-row { margin-bottom: 16px; }

.comp-row .comp-label {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.82rem;
  font-weight: 600;
  margin-bottom: 6px;
}

.comp-row .comp-label span:first-child { color: var(--color-secondary); }

.comp-diff {
  font-size: 0.72rem;
  padding: 2px 8px;
  border-radius: 10px;
  font-weight: 600;
}

.comp-diff.large-gap { background: #FDE8E2; color: var(--color-primary-dark); }
.comp-diff.small-gap { background: #E8F5EE; color: #3D8B63; }

.comp-bar-track {
  width: 100%;
  height: 10px;
  background: var(--color-border);
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 2px;
}

.comp-bar-fill {
  height: 100%;
  border-radius: 5px;
  transition: width 600ms cubic-bezier(0.22, 1, 0.36, 1);
}

.comp-bar-fill.user-bar { background: var(--color-primary); }
.comp-bar-fill.country-bar { background: var(--color-accent); opacity: 0.7; }
.comp-bar-fill.person-bar { background: #7C6FD0; }

.comp-legend {
  display: flex;
  gap: 16px;
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-bottom: 12px;
}

.comp-legend span::before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 4px;
  vertical-align: middle;
}

.comp-legend .legend-you::before { background: var(--color-primary); }
.comp-legend .legend-country::before { background: var(--color-accent); }
.comp-legend .legend-person::before { background: #7C6FD0; }

/* Gap & tip cards */
.gap-card, .tip-card {
  background: var(--color-bg-card);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  margin-bottom: 8px;
  border: 1px solid var(--color-border);
}

.gap-card { border-left: 4px solid var(--color-primary); }
.tip-card { border-left: 4px solid var(--color-accent); }

.gap-card .gap-dim-name, .tip-card .tip-dim {
  font-weight: 600;
  font-size: 0.82rem;
  margin-bottom: 4px;
}

.gap-card .gap-dim-name { color: var(--color-secondary); }
.tip-card .tip-dim { color: var(--color-accent); text-transform: uppercase; letter-spacing: 0.5px; }

.gap-card .gap-text, .tip-card .tip-text {
  font-size: 0.85rem;
  line-height: 1.55;
  color: var(--color-text-muted);
}

.tip-card .tip-text { color: var(--color-text); }

.section-heading { margin-bottom: 12px; font-size: 1.05rem; }

/* ============ RESPONSIVE ============ */
@media (max-width: 640px) {
  h1 { font-size: 2rem; }
  h2 { font-size: 1.5rem; }

  .welcome-features { flex-direction: column; }

  .spectrum-points { flex-direction: column; gap: 0; }
  .spectrum-point { border-left: none; border-top: 1px solid var(--color-border); padding: 8px 10px; }
  .spectrum-point:first-child { border-top: none; }

  .slider-label { font-size: 0.62rem; min-width: 50px; }

  .top-match .flag { font-size: 3.5rem; }
  .top-match .country-name { font-size: 1.6rem; }
  .top-match { padding: 24px 18px; }

  .country-search { width: 130px; }

  .share-code-box { flex-direction: column; }
  .compare-input-row { flex-direction: column; }

  .modal { max-height: 92vh; border-radius: 16px; }
  .modal-header { padding: 16px 18px 12px 18px; }
  .modal-body { padding: 16px 18px 24px 18px; }
  .modal-header .modal-flag { font-size: 2rem; }
}

/* ============ MISC ============ */
.hidden { display: none !important; }

.flag-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 700;
  min-width: 28px;
  height: 20px;
  padding: 0 4px;
  border-radius: 4px;
  background: var(--color-secondary);
  color: white;
  letter-spacing: 0.5px;
}

.retake-section {
  text-align: center;
  margin-top: 28px;
  padding-top: 20px;
  border-top: 1px solid var(--color-border);
}

.compare-error {
  color: var(--color-primary-dark);
  font-size: 0.82rem;
  margin-top: 8px;
}
</style>
</head>
<body>

<!-- Progress Bar -->
<div id="progress-bar">
  <div id="progress-fill"></div>
  <div id="progress-dots">
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
  </div>
</div>

<!-- Screen: Welcome -->
<section id="screen-welcome" class="screen welcome-screen active">
  <div class="screen-content welcome-content">
    <h1>What Country Are You?</h1>
    <p class="welcome-subtitle">Discover which country's culture matches your personal values, based on Geert Hofstede's 6 Dimensions of National Culture.</p>
    <div class="welcome-features">
      <div class="welcome-feature">
        <div class="feature-icon">&#127758;</div>
        <div class="feature-title">6 Quick Questions</div>
        <div class="feature-desc">Answer six sliders about your values and preferences.</div>
      </div>
      <div class="welcome-feature">
        <div class="feature-icon">&#127919;</div>
        <div class="feature-title">Your Culture Match</div>
        <div class="feature-desc">See which of 100+ countries aligns with your values.</div>
      </div>
      <div class="welcome-feature">
        <div class="feature-icon">&#9992;&#65039;</div>
        <div class="feature-title">Travel Tips</div>
        <div class="feature-desc">Get practical advice for visiting any country.</div>
      </div>
    </div>
    <div class="name-input-section">
      <input type="text" id="name-input" class="name-input" placeholder="Enter your name to begin..." maxlength="30" autocomplete="off">
      <div class="name-error" id="name-error"></div>
    </div>
    <button id="btn-start" class="btn-primary">Let's Find Out &#8594;</button>
  </div>
</section>

<!-- Dimension screens are generated by JS -->

<!-- Screen: Results -->
<section id="screen-results" class="screen">
  <div class="screen-content" id="results-content"></div>
</section>

<!-- Detail Modal -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal">
    <div class="modal-header" id="modal-header"></div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<script>
// ============================================================
// DATA: COUNTRIES
// ============================================================
const COUNTRIES = [
  {code:"US",name:"United States",pdi:40,idv:91,mas:62,uai:46,lto:26,ivr:68},
  {code:"GB",name:"United Kingdom",pdi:35,idv:89,mas:66,uai:35,lto:51,ivr:69},
  {code:"AU",name:"Australia",pdi:38,idv:90,mas:61,uai:51,lto:21,ivr:71},
  {code:"CA",name:"Canada",pdi:39,idv:80,mas:52,uai:48,lto:36,ivr:68},
  {code:"DE",name:"Germany",pdi:35,idv:67,mas:66,uai:65,lto:83,ivr:40},
  {code:"FR",name:"France",pdi:68,idv:71,mas:43,uai:86,lto:63,ivr:48},
  {code:"JP",name:"Japan",pdi:54,idv:46,mas:95,uai:92,lto:88,ivr:42},
  {code:"CN",name:"China",pdi:80,idv:20,mas:66,uai:30,lto:87,ivr:24},
  {code:"IN",name:"India",pdi:77,idv:48,mas:56,uai:40,lto:51,ivr:26},
  {code:"BR",name:"Brazil",pdi:69,idv:38,mas:49,uai:76,lto:44,ivr:59},
  {code:"MX",name:"Mexico",pdi:81,idv:30,mas:69,uai:82,lto:24,ivr:97},
  {code:"SE",name:"Sweden",pdi:31,idv:71,mas:5,uai:29,lto:53,ivr:78},
  {code:"NL",name:"Netherlands",pdi:38,idv:80,mas:14,uai:53,lto:67,ivr:68},
  {code:"DK",name:"Denmark",pdi:18,idv:74,mas:16,uai:23,lto:35,ivr:70},
  {code:"NO",name:"Norway",pdi:31,idv:69,mas:8,uai:50,lto:35,ivr:55},
  {code:"KR",name:"South Korea",pdi:60,idv:18,mas:39,uai:85,lto:100,ivr:29},
  {code:"IT",name:"Italy",pdi:50,idv:76,mas:70,uai:75,lto:61,ivr:30},
  {code:"ES",name:"Spain",pdi:57,idv:51,mas:42,uai:86,lto:48,ivr:44},
  {code:"RU",name:"Russia",pdi:93,idv:39,mas:36,uai:95,lto:81,ivr:20},
  {code:"TR",name:"Turkey",pdi:66,idv:37,mas:45,uai:85,lto:46,ivr:49},
  {code:"PL",name:"Poland",pdi:68,idv:60,mas:64,uai:93,lto:38,ivr:29},
  {code:"GR",name:"Greece",pdi:60,idv:35,mas:57,uai:100,lto:45,ivr:50},
  {code:"PT",name:"Portugal",pdi:63,idv:27,mas:31,uai:99,lto:28,ivr:33},
  {code:"IE",name:"Ireland",pdi:28,idv:70,mas:68,uai:35,lto:24,ivr:65},
  {code:"CH",name:"Switzerland",pdi:34,idv:68,mas:70,uai:58,lto:74,ivr:66},
  {code:"FI",name:"Finland",pdi:33,idv:63,mas:26,uai:59,lto:38,ivr:57},
  {code:"NZ",name:"New Zealand",pdi:22,idv:79,mas:58,uai:49,lto:33,ivr:75},
  {code:"AR",name:"Argentina",pdi:49,idv:46,mas:56,uai:86,lto:20,ivr:62},
  {code:"CO",name:"Colombia",pdi:67,idv:13,mas:64,uai:80,lto:13,ivr:83},
  {code:"CL",name:"Chile",pdi:63,idv:23,mas:28,uai:86,lto:31,ivr:68},
  {code:"TH",name:"Thailand",pdi:64,idv:20,mas:34,uai:64,lto:32,ivr:45},
  {code:"VN",name:"Vietnam",pdi:70,idv:20,mas:40,uai:30,lto:57,ivr:35},
  {code:"PH",name:"Philippines",pdi:94,idv:32,mas:64,uai:44,lto:27,ivr:42},
  {code:"ID",name:"Indonesia",pdi:78,idv:14,mas:46,uai:48,lto:62,ivr:38},
  {code:"MY",name:"Malaysia",pdi:100,idv:26,mas:50,uai:36,lto:41,ivr:57},
  {code:"SG",name:"Singapore",pdi:74,idv:20,mas:48,uai:8,lto:72,ivr:46},
  {code:"EG",name:"Egypt",pdi:70,idv:25,mas:45,uai:80,lto:7,ivr:4},
  {code:"NG",name:"Nigeria",pdi:80,idv:30,mas:60,uai:55,lto:13,ivr:84},
  {code:"ZA",name:"South Africa",pdi:49,idv:65,mas:63,uai:49,lto:34,ivr:63},
  {code:"SA",name:"Saudi Arabia",pdi:95,idv:25,mas:60,uai:80,lto:36,ivr:52},
  {code:"AE",name:"United Arab Emirates",pdi:90,idv:25,mas:50,uai:80,lto:null,ivr:null},
  {code:"IL",name:"Israel",pdi:13,idv:54,mas:47,uai:81,lto:38,ivr:null},
  {code:"PK",name:"Pakistan",pdi:55,idv:14,mas:50,uai:70,lto:50,ivr:0},
  {code:"KE",name:"Kenya",pdi:70,idv:25,mas:60,uai:50,lto:null,ivr:null},
  {code:"MA",name:"Morocco",pdi:70,idv:46,mas:53,uai:68,lto:14,ivr:25},
  {code:"RO",name:"Romania",pdi:90,idv:30,mas:42,uai:90,lto:52,ivr:20},
  {code:"HU",name:"Hungary",pdi:46,idv:80,mas:88,uai:82,lto:58,ivr:31},
  {code:"CZ",name:"Czech Republic",pdi:57,idv:58,mas:57,uai:74,lto:70,ivr:29},
  {code:"AT",name:"Austria",pdi:11,idv:55,mas:79,uai:70,lto:60,ivr:63},
  {code:"BE",name:"Belgium",pdi:65,idv:75,mas:54,uai:94,lto:82,ivr:57},
  {code:"AL",name:"Albania",pdi:90,idv:27,mas:80,uai:70,lto:56,ivr:15},
  {code:"DZ",name:"Algeria",pdi:80,idv:29,mas:35,uai:70,lto:25,ivr:32},
  {code:"AO",name:"Angola",pdi:83,idv:18,mas:20,uai:60,lto:15,ivr:83},
  {code:"AM",name:"Armenia",pdi:85,idv:17,mas:50,uai:88,lto:38,ivr:25},
  {code:"AZ",name:"Azerbaijan",pdi:85,idv:28,mas:50,uai:88,lto:59,ivr:22},
  {code:"BD",name:"Bangladesh",pdi:80,idv:20,mas:55,uai:60,lto:47,ivr:20},
  {code:"BY",name:"Belarus",pdi:95,idv:48,mas:20,uai:95,lto:53,ivr:15},
  {code:"BO",name:"Bolivia",pdi:78,idv:23,mas:42,uai:87,lto:21,ivr:46},
  {code:"BA",name:"Bosnia and Herzegovina",pdi:90,idv:40,mas:48,uai:87,lto:36,ivr:44},
  {code:"BG",name:"Bulgaria",pdi:70,idv:30,mas:40,uai:85,lto:69,ivr:16},
  {code:"BF",name:"Burkina Faso",pdi:70,idv:15,mas:50,uai:55,lto:27,ivr:18},
  {code:"CV",name:"Cape Verde",pdi:75,idv:20,mas:15,uai:40,lto:12,ivr:83},
  {code:"HR",name:"Croatia",pdi:73,idv:33,mas:40,uai:80,lto:58,ivr:33},
  {code:"DO",name:"Dominican Republic",pdi:65,idv:38,mas:65,uai:45,lto:11,ivr:54},
  {code:"EC",name:"Ecuador",pdi:78,idv:8,mas:63,uai:67,lto:24,ivr:null},
  {code:"SV",name:"El Salvador",pdi:66,idv:19,mas:40,uai:94,lto:20,ivr:89},
  {code:"EE",name:"Estonia",pdi:40,idv:60,mas:30,uai:60,lto:82,ivr:16},
  {code:"GH",name:"Ghana",pdi:80,idv:15,mas:40,uai:65,lto:4,ivr:72},
  {code:"HK",name:"Hong Kong",pdi:68,idv:25,mas:57,uai:29,lto:61,ivr:17},
  {code:"IR",name:"Iran",pdi:58,idv:41,mas:43,uai:59,lto:14,ivr:40},
  {code:"IQ",name:"Iraq",pdi:95,idv:30,mas:70,uai:85,lto:25,ivr:17},
  {code:"JO",name:"Jordan",pdi:70,idv:30,mas:45,uai:65,lto:16,ivr:43},
  {code:"KZ",name:"Kazakhstan",pdi:88,idv:20,mas:50,uai:88,lto:null,ivr:null},
  {code:"LV",name:"Latvia",pdi:44,idv:70,mas:9,uai:63,lto:69,ivr:13},
  {code:"LB",name:"Lebanon",pdi:75,idv:40,mas:65,uai:50,lto:14,ivr:25},
  {code:"LT",name:"Lithuania",pdi:42,idv:60,mas:19,uai:65,lto:82,ivr:16},
  {code:"LU",name:"Luxembourg",pdi:40,idv:60,mas:50,uai:70,lto:64,ivr:56},
  {code:"MT",name:"Malta",pdi:56,idv:59,mas:47,uai:96,lto:47,ivr:66},
  {code:"PE",name:"Peru",pdi:64,idv:16,mas:42,uai:87,lto:25,ivr:46},
  {code:"SI",name:"Slovenia",pdi:71,idv:27,mas:19,uai:88,lto:49,ivr:48},
  {code:"SK",name:"Slovakia",pdi:100,idv:52,mas:100,uai:51,lto:77,ivr:28},
  {code:"TW",name:"Taiwan",pdi:58,idv:17,mas:45,uai:69,lto:93,ivr:49},
  {code:"TN",name:"Tunisia",pdi:80,idv:25,mas:40,uai:75,lto:26,ivr:52},
  {code:"TT",name:"Trinidad and Tobago",pdi:47,idv:16,mas:58,uai:55,lto:13,ivr:80},
  {code:"UA",name:"Ukraine",pdi:92,idv:25,mas:27,uai:95,lto:55,ivr:18},
  {code:"UY",name:"Uruguay",pdi:61,idv:36,mas:38,uai:100,lto:26,ivr:53},
  {code:"VE",name:"Venezuela",pdi:81,idv:12,mas:73,uai:76,lto:16,ivr:100},
  {code:"RS",name:"Serbia",pdi:86,idv:25,mas:43,uai:92,lto:52,ivr:28},
  {code:"LY",name:"Libya",pdi:80,idv:38,mas:52,uai:68,lto:23,ivr:26},
  {code:"TZ",name:"Tanzania",pdi:70,idv:25,mas:40,uai:50,lto:34,ivr:38},
  {code:"UG",name:"Uganda",pdi:65,idv:27,mas:45,uai:52,lto:24,ivr:52},
  {code:"ZM",name:"Zambia",pdi:60,idv:35,mas:40,uai:50,lto:30,ivr:42},
  {code:"MW",name:"Malawi",pdi:70,idv:30,mas:40,uai:50,lto:18,ivr:47},
  {code:"MZ",name:"Mozambique",pdi:85,idv:15,mas:38,uai:44,lto:11,ivr:80},
  {code:"SN",name:"Senegal",pdi:70,idv:25,mas:45,uai:55,lto:25,ivr:47},
  {code:"ML",name:"Mali",pdi:80,idv:20,mas:45,uai:50,lto:20,ivr:43},
  {code:"NE",name:"Niger",pdi:80,idv:15,mas:45,uai:50,lto:15,ivr:28},
  {code:"CM",name:"Cameroon",pdi:78,idv:27,mas:48,uai:54,lto:16,ivr:49},
  {code:"CI",name:"Ivory Coast",pdi:80,idv:20,mas:40,uai:50,lto:16,ivr:46},
  {code:"CR",name:"Costa Rica",pdi:35,idv:15,mas:21,uai:86,lto:null,ivr:null},
  {code:"PA",name:"Panama",pdi:95,idv:11,mas:44,uai:86,lto:null,ivr:null},
  {code:"GT",name:"Guatemala",pdi:95,idv:6,mas:37,uai:101,lto:null,ivr:null},
  {code:"HN",name:"Honduras",pdi:80,idv:20,mas:40,uai:50,lto:null,ivr:null},
  {code:"NI",name:"Nicaragua",pdi:68,idv:30,mas:40,uai:50,lto:null,ivr:null},
  {code:"PY",name:"Paraguay",pdi:70,idv:15,mas:40,uai:85,lto:null,ivr:null},
  {code:"CU",name:"Cuba",pdi:63,idv:12,mas:45,uai:80,lto:null,ivr:null}
];

const seen = new Set();
const COUNTRY_DATA = COUNTRIES.filter(c => {
  if (seen.has(c.code)) return false;
  seen.add(c.code);
  return true;
});

// ============================================================
// DATA: DIMENSIONS (with spectrum descriptions, no country examples)
// ============================================================
const DIMENSIONS = [
  {
    key: 'pdi',
    name: 'Power Distance',
    question: 'Think about your workplace, school, or family. How do you feel about hierarchy \u2014 should everyone be equal, or is it natural for some people to have more authority?',
    lowLabel: 'Egalitarian',
    highLabel: 'Hierarchical',
    spectrum: [
      {marker: 'Far left', text: '\u2022 Openly challenge your boss in front of everyone\n\u2022 The intern\u2019s idea is as valid as the director\u2019s\n\u2022 No one deserves authority just for their title'},
      {marker: 'Leaning left', text: '\u2022 Flat teams, open-door managers\n\u2022 Speak up if you disagree'},
      {marker: 'Centre', text: '\u2022 Respect authority but expect to be heard'},
      {marker: 'Leaning right', text: '\u2022 Follow the chain of command\n\u2022 Seniority earns respect'},
      {marker: 'Far right', text: '\u2022 Never contradict someone senior \u2014 ever\n\u2022 Stand when an elder enters the room\n\u2022 Questioning authority feels deeply wrong'}
    ],
    gapText: {
      higher: "You value hierarchy more than this culture does. You might find the informality surprising \u2014 people may seem disrespectful toward authority figures, and the lack of clear chain-of-command can feel disorganized.",
      lower: "You value equality more than this culture does. You may find the deference to authority stifling. Expect to navigate more formal hierarchies in workplaces, and show respect for age and seniority."
    },
    travelTips: {
      higher: [
        "Don't be surprised if employees address managers by first name \u2014 it's normal, not disrespectful.",
        "In meetings, everyone's opinion may be solicited regardless of rank. Feel free to speak up.",
        "Dress codes and formality tend to be more relaxed than you might expect."
      ],
      lower: [
        "Address people by their title (Mr., Dr., Professor) until invited to use first names.",
        "In business settings, let senior people speak first and make decisions. Don't openly challenge a superior in front of others.",
        "Observe seating arrangements \u2014 the most senior person often sits at the head of the table.",
        "Show particular respect for elders in social situations."
      ]
    }
  },
  {
    key: 'idv',
    name: 'Individualism',
    question: 'When making a big life decision \u2014 like taking a new job or moving cities \u2014 how much weight do you give to what your family or community thinks vs what you personally want?',
    lowLabel: 'Collectivist',
    highLabel: 'Individualist',
    spectrum: [
      {marker: 'Far left', text: '\u2022 Quit your dream job to care for family \u2014 no question\n\u2022 \u2018I\u2019 doesn\u2019t exist \u2014 only \u2018we\u2019\n\u2022 Shame on the family is shame on you'},
      {marker: 'Leaning left', text: '\u2022 Family\u2019s opinion seriously shapes big decisions\n\u2022 Feel responsible for extended family'},
      {marker: 'Centre', text: '\u2022 Balance personal goals with family expectations'},
      {marker: 'Leaning right', text: '\u2022 Your career, your call\n\u2022 Keep family informed, not involved'},
      {marker: 'Far right', text: '\u2022 Move across the world without asking anyone\n\u2022 Depend on no one \u2014 total self-reliance\n\u2022 Your life is yours alone'}
    ],
    gapText: {
      higher: "You're more individualistic than this culture. People here place great value on group harmony, family obligations, and loyalty. What you see as self-reliance may be seen as selfishness.",
      lower: "You're more collectivist than this culture. You may find the emphasis on self-reliance and personal achievement cold or isolating. People may seem less willing to help or less interested in building deep bonds."
    },
    travelTips: {
      higher: [
        "Don't decline invitations to group meals or activities \u2014 socializing builds essential trust.",
        "Avoid singling yourself out for praise. Acknowledge the team or group contribution.",
        "Gift-giving may be an important social ritual. Reciprocate thoughtfully.",
        "Family topics in conversation show genuine interest, not nosiness."
      ],
      lower: [
        "People may prefer to keep personal and professional life separate \u2014 don't take it personally.",
        "It's normal to eat alone or make plans independently. This isn't a sign of unfriendliness.",
        "Be direct about what you want or need rather than hinting \u2014 directness is valued here.",
        "Personal space and privacy are important. Don't ask overly personal questions early on."
      ]
    }
  },
  {
    key: 'mas',
    name: 'Masculinity',
    question: 'Imagine you\u2019re choosing between two jobs: one pays significantly more but demands 60-hour weeks, the other pays less but gives you great work-life balance. Which pulls you more?',
    lowLabel: 'Caring',
    highLabel: 'Competitive',
    spectrum: [
      {marker: 'Far left', text: '\u2022 Success means being kind, not being rich\n\u2022 Competition makes you uncomfortable\n\u2022 Would happily earn less for more time with family'},
      {marker: 'Leaning left', text: '\u2022 Free time and relationships over promotions\n\u2022 Bragging feels tasteless'},
      {marker: 'Centre', text: '\u2022 Ambitious but not at any cost'},
      {marker: 'Leaning right', text: '\u2022 Love the thrill of winning\n\u2022 Admire high achievers'},
      {marker: 'Far right', text: '\u2022 Second place is first loser\n\u2022 Work defines who you are\n\u2022 Always choose more money \u2014 always'}
    ],
    gapText: {
      higher: "You're more competitive than this culture. People here prioritize work-life balance and cooperation over individual achievement. Boasting about success may be seen as tasteless.",
      lower: "You're more caring-oriented than this culture. Expect a more competitive atmosphere. People take professional success seriously and may work longer hours. Assertiveness is valued and expected."
    },
    travelTips: {
      higher: [
        "Tone down self-promotion \u2014 modesty is valued. Let your work speak for itself.",
        "Work-life balance is taken seriously. Don't expect people to answer emails on weekends.",
        "Consensus and cooperation are preferred over aggressive negotiation.",
        "Gender roles tend to be more equal, with shared household and parenting duties."
      ],
      lower: [
        "Be prepared for a more driven, results-oriented work culture.",
        "Business conversations may be direct and competitive \u2014 this isn't personal.",
        "Professional achievements and titles carry significant social weight.",
        "Working late or on weekends may be seen as dedication, not poor planning."
      ]
    }
  },
  {
    key: 'uai',
    name: 'Uncertainty Avoidance',
    question: 'You\u2019re about to go on holiday with no hotel booked and only a rough idea of where you\u2019re going. How does that make you feel \u2014 excited or anxious?',
    lowLabel: 'Flexible',
    highLabel: 'Structured',
    spectrum: [
      {marker: 'Far left', text: '\u2022 Quit your job tomorrow and figure it out later\n\u2022 Rules? What rules?\n\u2022 Chaos is just another word for opportunity'},
      {marker: 'Leaning left', text: '\u2022 Wing it with a rough idea\n\u2022 Change of plans? No problem'},
      {marker: 'Centre', text: '\u2022 Like a plan but can adapt without stress'},
      {marker: 'Leaning right', text: '\u2022 Research everything before deciding\n\u2022 Surprises are unwelcome'},
      {marker: 'Far right', text: '\u2022 Every day planned hour by hour\n\u2022 The unknown fills you with dread\n\u2022 There\u2019s a right way to do everything \u2014 follow it'}
    ],
    gapText: {
      higher: "You prefer more structure than this culture provides. You may find the relaxed approach to rules and timelines unsettling. Plans may change frequently, and ambiguity is tolerated more readily.",
      lower: "You're more flexible than this culture. Expect detailed procedures, strict timelines, and many rules. People may seem anxious about change or breaking from established routines."
    },
    travelTips: {
      higher: [
        "Be prepared for a more relaxed approach to schedules and deadlines.",
        "Rules may be treated as guidelines rather than absolutes.",
        "People may be more comfortable with 'let's figure it out as we go' approaches.",
        "Bureaucracy may be lighter, but things may feel less predictable."
      ],
      lower: [
        "Punctuality is very important \u2014 arrive on time or slightly early.",
        "Follow rules and procedures carefully, even if they seem unnecessary.",
        "Written agreements and detailed contracts are preferred over handshake deals.",
        "Don't improvise in formal settings \u2014 prepare thoroughly and stick to the plan.",
        "Expect more paperwork and bureaucratic processes."
      ]
    }
  },
  {
    key: 'lto',
    name: 'Tradition vs Pragmatism',
    question: 'Think about how you approach money and traditions. Do you save carefully for the future and adapt traditions when they no longer serve a purpose? Or do you enjoy the moment and believe traditions should be kept as they are?',
    lowLabel: 'Live for today',
    highLabel: 'Plan for tomorrow',
    spectrum: [
      {marker: 'Far left', text: '\u2022 Traditions are sacred \u2014 never change them\n\u2022 Why save when you could enjoy it now?\n\u2022 There are absolute rights and wrongs'},
      {marker: 'Leaning left', text: '\u2022 Honour the old ways\n\u2022 Enjoy today, tomorrow sorts itself out'},
      {marker: 'Centre', text: '\u2022 Respect traditions but update what doesn\u2019t work'},
      {marker: 'Leaning right', text: '\u2022 Invest now, enjoy later\n\u2022 Adapt traditions if they hold you back'},
      {marker: 'Far right', text: '\u2022 Skip Christmas dinner for a business opportunity\n\u2022 Tradition is just peer pressure from dead people\n\u2022 Everything is a long-term investment'}
    ],
    gapText: {
      higher: "You're more future-oriented than this culture. People here value traditions, quick results, and established ways. Your long-term planning mindset may clash with a preference for immediate outcomes.",
      lower: "You're more tradition-oriented than this culture. People here prioritize pragmatism and long-term planning over maintaining traditions. They may seem overly focused on saving and future outcomes."
    },
    travelTips: {
      higher: [
        "Respect local traditions and rituals, even if they seem inefficient.",
        "People may expect faster turnaround and more immediate results.",
        "Spending and generosity may be valued more than thriftiness.",
        "Social norms and 'the way things have always been done' carry strong weight."
      ],
      lower: [
        "People think in decades, not quarters. Be patient with decision timelines.",
        "Education and self-improvement are highly valued \u2014 show interest in learning.",
        "Frugality is respected. Wasteful spending may be judged negatively.",
        "Persistence and perseverance are admired traits. Don't give up easily.",
        "Relationships are investments \u2014 nurture them over time."
      ]
    }
  },
  {
    key: 'ivr',
    name: 'Indulgence',
    question: 'It\u2019s Friday night, you\u2019ve had a long week, and your friends invite you out for dinner at a nice restaurant. Your budget is tight this month. What do you do?',
    lowLabel: 'Restrained',
    highLabel: 'Indulgent',
    spectrum: [
      {marker: 'Far left', text: '\u2022 Guilt follows every small pleasure\n\u2022 Duty before happiness \u2014 always\n\u2022 Wanting things for yourself feels selfish'},
      {marker: 'Leaning left', text: '\u2022 Discipline over indulgence\n\u2022 Stay in and save \u2014 that\u2019s the right call'},
      {marker: 'Centre', text: '\u2022 Treat yourself sometimes, within reason'},
      {marker: 'Leaning right', text: '\u2022 Say yes to fun \u2014 figure the rest out later\n\u2022 Experiences over savings'},
      {marker: 'Far right', text: '\u2022 Life is a party and you\u2019re the guest of honour\n\u2022 Buy it, eat it, do it \u2014 worry never\n\u2022 Happiness is the whole point of being alive'}
    ],
    gapText: {
      higher: "You're more fun-loving than this culture. People here may seem serious or reserved. Public displays of enjoyment and spontaneity might be frowned upon. Duty and discipline are prioritized.",
      lower: "You're more restrained than this culture. People here openly enjoy life, express emotions freely, and prioritize leisure. This may feel excessive or irresponsible to you."
    },
    travelTips: {
      higher: [
        "Be more reserved with public displays of excitement or loud celebrations.",
        "Leisure activities may be seen as less important than work and duties.",
        "Modesty in dress and behavior is often appreciated.",
        "People may seem more serious \u2014 this isn't unfriendliness, it's cultural norm.",
        "Control impulse purchases and openly self-indulgent behavior."
      ],
      lower: [
        "Embrace the social scene \u2014 people love to gather, celebrate, and enjoy life.",
        "Expect lively conversations, humor, and physical warmth (hugs, kisses as greeting).",
        "Leisure, festivals, and social events are important parts of the culture.",
        "Smiling and expressing positive emotions is expected and welcomed.",
        "Food and drink are central to socializing \u2014 enjoy the local cuisine."
      ]
    }
  }
];

// ============================================================
// COUNTRY FLAG HELPER
// ============================================================
const isWindows = navigator.userAgent.includes('Windows');

function getFlag(code) {
  if (isWindows) return `<span class="flag-badge">${code}</span>`;
  const cp = (c) => 0x1F1E6 - 65 + c.charCodeAt(0);
  return String.fromCodePoint(cp(code[0]), cp(code[1]));
}

function getFlagText(code) {
  if (isWindows) return code;
  const cp = (c) => 0x1F1E6 - 65 + c.charCodeAt(0);
  return String.fromCodePoint(cp(code[0]), cp(code[1]));
}

// ============================================================
// STATE
// ============================================================
const state = {
  currentScreen: 0,
  playerName: '',
  scores: { pdi: 50, idv: 50, mas: 50, uai: 50, lto: 50, ivr: 50 },
  weights: { pdi: 1, idv: 1, mas: 1, uai: 1, lto: 1, ivr: 1 },
  results: null,
  homeCountry: null
};

// ============================================================
// LOCAL STORAGE
// ============================================================
const STORAGE_KEY = 'whatcountry_results';

function loadSavedResults() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  } catch { return []; }
}

function saveResult(name, scores, topMatch) {
  const saved = loadSavedResults();
  saved.push({
    name: name || 'Anonymous',
    scores: { ...scores },
    topMatch: topMatch,
    timestamp: Date.now()
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
}

function clearSavedResults() {
  localStorage.removeItem(STORAGE_KEY);
}

// ============================================================
// SHARE CODE
// ============================================================
function encodeScore(name, scores) {
  const n = (name || 'Anonymous').replace(/\|/g, '').substring(0, 20);
  return `${n}|${scores.pdi}|${scores.idv}|${scores.mas}|${scores.uai}|${scores.lto}|${scores.ivr}`;
}

function decodeScore(code) {
  const parts = code.trim().split('|');
  if (parts.length !== 7) return null;
  const name = parts[0];
  const vals = parts.slice(1).map(Number);
  if (vals.some(v => isNaN(v) || v < 0 || v > 100)) return null;
  return {
    name,
    scores: { pdi: vals[0], idv: vals[1], mas: vals[2], uai: vals[3], lto: vals[4], ivr: vals[5] }
  };
}

// ============================================================
// BUILD DIMENSION SCREENS
// ============================================================
function buildDimScreens() {
  const container = document.getElementById('screen-results');
  DIMENSIONS.forEach((dim, i) => {
    const section = document.createElement('section');
    section.id = `screen-dim-${i}`;
    section.className = 'screen dim-screen';
    section.innerHTML = `
      <div class="screen-content">
        <span class="dim-number">Question ${i + 1} of 6</span>
        <h2 class="dim-title">${dim.name}</h2>
        <p class="dim-question">${dim.question}</p>
        <div class="spectrum-container">
          <div class="spectrum-labels">
            <span class="spectrum-label-left">${dim.lowLabel}</span>
            <span class="spectrum-label-right">${dim.highLabel}</span>
          </div>
          <div class="spectrum-points">
            ${dim.spectrum.map(sp => `
              <div class="spectrum-point">
                <span class="sp-marker">${sp.marker}</span>
                <span class="sp-text">${sp.text}</span>
              </div>
            `).join('')}
          </div>
        </div>
        <div class="slider-container">
          <span class="slider-label slider-label-left">${dim.lowLabel}</span>
          <input type="range" min="1" max="100" value="50" class="custom-slider" data-dim="${dim.key}" style="--val:50%">
          <span class="slider-label slider-label-right">${dim.highLabel}</span>
        </div>
        <div class="importance-toggle">
          <span>How much does this matter to you?</span>
          <div class="importance-btns" data-dim="${dim.key}">
            <button class="imp-btn" data-weight="0.3">Less</button>
            <button class="imp-btn active" data-weight="1">Normal</button>
            <button class="imp-btn" data-weight="2">More</button>
          </div>
        </div>
        <div class="nav-buttons">
          <button class="btn-secondary btn-back">&larr; Back</button>
          <button class="btn-primary btn-next">${i === 5 ? 'See Results &rarr;' : 'Next &rarr;'}</button>
        </div>
      </div>
    `;
    container.parentNode.insertBefore(section, container);
  });
}

buildDimScreens();

const allScreens = [
  document.getElementById('screen-welcome'),
  ...DIMENSIONS.map((_, i) => document.getElementById(`screen-dim-${i}`)),
  document.getElementById('screen-results')
];

// ============================================================
// NAVIGATION
// ============================================================
function navigateTo(target) {
  const current = state.currentScreen;
  if (target === current) return;
  const direction = target > current ? 'forward' : 'back';
  const currentEl = allScreens[current];
  const targetEl = allScreens[target];

  currentEl.classList.remove('active');
  currentEl.classList.add(direction === 'forward' ? 'exit-left' : 'exit-right');

  targetEl.classList.remove('exit-left', 'exit-right');
  targetEl.classList.add('active');

  setTimeout(() => { currentEl.classList.remove('exit-left', 'exit-right'); }, 700);

  state.currentScreen = target;
  updateProgress();

  if (target === 7) targetEl.scrollTop = 0;
}

function updateProgress() {
  const bar = document.getElementById('progress-bar');
  const fill = document.getElementById('progress-fill');
  const dots = document.querySelectorAll('.dot');

  if (state.currentScreen >= 1 && state.currentScreen <= 6) {
    bar.classList.add('visible');
    fill.style.width = ((state.currentScreen) / 6 * 100) + '%';
    dots.forEach((dot, i) => {
      dot.className = 'dot';
      if (i < state.currentScreen - 1) dot.classList.add('completed');
      if (i === state.currentScreen - 1) dot.classList.add('active');
    });
  } else {
    bar.classList.remove('visible');
  }
}

// ============================================================
// SCORING
// ============================================================
function computeResults() {
  const keys = ['pdi', 'idv', 'mas', 'uai', 'lto', 'ivr'];
  const userScores = keys.map(k => state.scores[k]);
  const userWeights = keys.map(k => state.weights[k]);
  const totalWeight = userWeights.reduce((a, b) => a + b, 0);

  const results = COUNTRY_DATA.map(country => {
    let weightedSumSq = 0, validWeight = 0;
    keys.forEach((k, i) => {
      const cv = country[k];
      if (cv !== null && cv !== undefined) {
        weightedSumSq += userWeights[i] * Math.pow(userScores[i] - cv, 2);
        validWeight += userWeights[i];
      }
    });
    // Normalize: scale as if all dimensions had full weight
    const distance = validWeight > 0 ? Math.sqrt(weightedSumSq * (totalWeight / validWeight)) : 9999;
    const maxDist = Math.sqrt(totalWeight) * 100;
    const matchPct = Math.max(0, Math.round((1 - distance / maxDist) * 100));
    return { ...country, distance, matchPct };
  });

  results.sort((a, b) => a.distance - b.distance);
  state.results = results;
}

// ============================================================
// MATCH EXPLANATION
// ============================================================
function generateMatchExplanation(country) {
  const keys = ['pdi', 'idv', 'mas', 'uai', 'lto', 'ivr'];
  const alignments = keys
    .filter(k => country[k] !== null && country[k] !== undefined)
    .map(k => ({
      key: k,
      diff: Math.abs(state.scores[k] - country[k]),
      userVal: state.scores[k],
      countryVal: country[k]
    }))
    .sort((a, b) => a.diff - b.diff);

  const top = alignments.slice(0, 3);
  let text = `Your values closely mirror the culture of ${country.name}. `;

  top.forEach(a => {
    const dim = DIMENSIONS.find(d => d.key === a.key);
    const level = a.countryVal > 60 ? 'high' : a.countryVal < 40 ? 'low' : 'moderate';
    const dimName = dim.name.toLowerCase();
    if (level === 'high') {
      text += `Like ${country.name}, you score high on ${dimName}, valuing ${dim.highLabel.toLowerCase()} approaches. `;
    } else if (level === 'low') {
      text += `Like ${country.name}, you lean toward ${dim.lowLabel.toLowerCase()} values in ${dimName}. `;
    } else {
      text += `You share a balanced view on ${dimName} with ${country.name}. `;
    }
  });

  return text;
}

// ============================================================
// RENDER RESULTS
// ============================================================
function renderResults() {
  const content = document.getElementById('results-content');
  const top = state.results[0];
  const nameDisplay = state.playerName || 'You';
  const shareCode = encodeScore(state.playerName, state.scores);

  // Save to localStorage
  saveResult(state.playerName, state.scores, { code: top.code, name: top.name, matchPct: top.matchPct });

  content.innerHTML = `
    <div class="loading-overlay" id="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">Analysing ${nameDisplay === 'You' ? 'your' : nameDisplay + "'s"} cultural profile...</div>
    </div>
    <div id="results-inner" class="hidden"></div>
  `;

  setTimeout(() => {
    document.getElementById('loading').classList.add('hidden');
    const inner = document.getElementById('results-inner');
    inner.classList.remove('hidden');

    const explanation = generateMatchExplanation(top);
    const saved = loadSavedResults();
    // Filter out the entry we just saved (current user)
    const otherSaved = saved.filter((s, i) => i < saved.length - 1);

    let html = `
      <div class="top-match reveal">
        <div class="result-label">${nameDisplay === 'You' ? 'You are' : nameDisplay + ' is'} most culturally aligned with</div>
        <span class="flag flag-bounce">${getFlag(top.code)}</span>
        <h2 class="country-name">${top.name}</h2>
        <span class="match-pct">${top.matchPct}% match</span>
        <p class="match-explanation">${explanation}</p>
      </div>

      <div class="result-section reveal reveal-delay-1">
        <h3>Where are you actually from?</h3>
        <select class="home-select" id="home-select">
          <option value="">Select your country...</option>
          ${[...COUNTRY_DATA].sort((a, b) => a.name.localeCompare(b.name)).map(c => `<option value="${c.code}">${getFlagText(c.code)} ${c.name}</option>`).join('')}
        </select>
        <div id="home-comparison"></div>
      </div>

      <div class="result-section share-section reveal reveal-delay-2">
        <h3>Share Your Score</h3>
        <p style="font-size:0.85rem;color:var(--color-text-muted);margin-bottom:12px;">Copy this code and send it to someone. They can paste it in to compare with you.</p>
        <div class="share-code-box">
          <input type="text" class="share-code" id="share-code" value="${shareCode}" readonly>
          <button class="btn-copy" id="btn-copy">Copy</button>
        </div>
        <div class="compare-input-box">
          <label>Compare with someone else</label>
          <div class="compare-input-row">
            <input type="text" class="compare-input" id="compare-input" placeholder="Paste their code here...">
            <button class="btn-compare" id="btn-compare">Compare</button>
          </div>
          <div id="compare-error"></div>
        </div>
      </div>`;

    if (otherSaved.length > 0) {
      html += `
      <div class="result-section reveal reveal-delay-3">
        <div class="saved-header">
          <h3>Previous Results</h3>
          <button class="btn-small" id="btn-clear-saved">Clear All</button>
        </div>
        <div class="saved-list" id="saved-list">
          ${otherSaved.map((s, i) => `
            <div class="saved-item" data-idx="${i}">
              <span class="si-name">${s.name}</span>
              <span class="si-match">${getFlag(s.topMatch.code)} ${s.topMatch.name} (${s.topMatch.matchPct}%)</span>
              <span class="si-date">${new Date(s.timestamp).toLocaleDateString()}</span>
              <span class="si-arrow">&#8250;</span>
            </div>
          `).join('')}
        </div>
      </div>`;
    }

    html += `
      <div class="reveal reveal-delay-2" style="margin-top:20px;">
        <div class="country-list-header">
          <h3>All Countries Ranked</h3>
          <input type="text" class="country-search" id="country-search" placeholder="Search countries...">
        </div>
        <div class="country-list" id="country-list"></div>
      </div>

      <div class="retake-section reveal reveal-delay-3">
        <button class="btn-secondary" id="btn-retake">&larr; Retake Quiz</button>
      </div>
    `;

    inner.innerHTML = html;
    renderCountryList(state.results);
    bindResultEvents();
  }, 1800);
}

function renderCountryList(countries) {
  const list = document.getElementById('country-list');
  list.innerHTML = countries.map((c) => {
    const rank = state.results.indexOf(c) + 1;
    return `
    <div class="country-item ${rank === 1 ? 'is-top' : ''}" data-code="${c.code}">
      <span class="ci-rank">#${rank}</span>
      <span class="ci-flag">${getFlag(c.code)}</span>
      <span class="ci-name">${c.name}</span>
      <span class="ci-pct">${c.matchPct}%</span>
      <span class="ci-arrow">&#8250;</span>
    </div>
  `;
  }).join('');
}

function bindResultEvents() {
  // Country search
  document.getElementById('country-search').addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase();
    const filtered = state.results.filter(c => c.name.toLowerCase().includes(q));
    renderCountryList(filtered);
  });

  // Home country select
  document.getElementById('home-select').addEventListener('change', (e) => {
    state.homeCountry = e.target.value || null;
    renderHomeComparison();
  });

  // Copy button
  document.getElementById('btn-copy').addEventListener('click', () => {
    const codeEl = document.getElementById('share-code');
    navigator.clipboard.writeText(codeEl.value).then(() => {
      const btn = document.getElementById('btn-copy');
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
    }).catch(() => {
      codeEl.select();
      document.execCommand('copy');
    });
  });

  // Compare button
  document.getElementById('btn-compare').addEventListener('click', () => {
    const code = document.getElementById('compare-input').value;
    const decoded = decodeScore(code);
    const errEl = document.getElementById('compare-error');
    if (!decoded) {
      errEl.innerHTML = '<p class="compare-error">Invalid code. It should look like: Name|40|91|62|46|26|68</p>';
      return;
    }
    errEl.innerHTML = '';
    openPersonCompareModal(decoded.name, decoded.scores);
  });

  // Enter key on compare input
  document.getElementById('compare-input').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') document.getElementById('btn-compare').click();
  });

  // Retake
  document.getElementById('btn-retake').addEventListener('click', () => { navigateTo(0); });

  // Country list clicks (event delegation)
  document.getElementById('country-list').addEventListener('click', (e) => {
    const item = e.target.closest('.country-item');
    if (!item) return;
    const code = item.dataset.code;
    const country = state.results.find(c => c.code === code);
    if (country) openCountryModal(country);
  });

  // Clear saved
  const clearBtn = document.getElementById('btn-clear-saved');
  if (clearBtn) {
    clearBtn.addEventListener('click', () => {
      clearSavedResults();
      const savedSection = clearBtn.closest('.result-section');
      if (savedSection) savedSection.remove();
    });
  }

  // Saved item clicks
  const savedList = document.getElementById('saved-list');
  if (savedList) {
    savedList.addEventListener('click', (e) => {
      const item = e.target.closest('.saved-item');
      if (!item) return;
      const idx = parseInt(item.dataset.idx);
      const saved = loadSavedResults();
      const entry = saved[idx];
      if (entry) openPersonCompareModal(entry.name, entry.scores);
    });
  }
}

// ============================================================
// HOME COMPARISON
// ============================================================
function renderHomeComparison() {
  const container = document.getElementById('home-comparison');
  if (!state.homeCountry) { container.innerHTML = ''; return; }

  const country = COUNTRY_DATA.find(c => c.code === state.homeCountry);
  if (!country) return;

  const keys = ['pdi', 'idv', 'mas', 'uai', 'lto', 'ivr'];
  let gaps = [];
  let similarities = [];

  keys.forEach(k => {
    const dim = DIMENSIONS.find(d => d.key === k);
    const uv = state.scores[k];
    const cv = country[k];
    if (cv === null || cv === undefined) return;
    const diff = uv - cv;
    const absDiff = Math.abs(diff);
    if (absDiff > 15) {
      gaps.push({ dim, diff, text: diff > 0 ? dim.gapText.higher : dim.gapText.lower });
    } else {
      const level = cv > 60 ? 'high' : cv < 40 ? 'low' : 'moderate';
      let simText = '';
      if (level === 'high') simText = `You both value ${dim.highLabel.toLowerCase()} approaches to ${dim.name.toLowerCase()}.`;
      else if (level === 'low') simText = `You both lean toward ${dim.lowLabel.toLowerCase()} values.`;
      else simText = `You share a balanced view on ${dim.name.toLowerCase()}.`;
      similarities.push({ dim, text: simText });
    }
  });

  let html = `<div style="margin-top:20px;">`;
  html += `<h3 style="font-size:1rem;margin-bottom:12px;">You vs ${country.name}</h3>`;

  // Always show comparison bars
  html += `<div class="comp-legend"><span class="legend-you">You</span><span class="legend-country">${country.name}</span></div>`;
  keys.forEach(k => {
    const dim = DIMENSIONS.find(d => d.key === k);
    const uv = state.scores[k];
    const cv = country[k];
    if (cv === null || cv === undefined) return;
    const diff = Math.abs(uv - cv);
    const diffClass = diff > 15 ? 'large-gap' : 'small-gap';
    html += `
      <div class="comp-row">
        <div class="comp-label">
          <span>${dim.name}</span>
          <span class="comp-diff ${diffClass}">${diff === 0 ? 'Same' : (uv > cv ? '+' : '-') + diff}</span>
        </div>
        <div class="comp-bar-track"><div class="comp-bar-fill user-bar" style="width:${uv}%"></div></div>
        <div class="comp-bar-track"><div class="comp-bar-fill country-bar" style="width:${Math.min(cv, 100)}%"></div></div>
      </div>`;
  });

  if (similarities.length > 0) {
    html += `<h4 style="font-size:0.9rem;margin:16px 0 8px;color:var(--color-accent);font-family:var(--font-heading);">Where you're similar</h4>`;
    similarities.forEach(s => {
      html += `<div class="tip-card" style="border-left-color:var(--color-accent);"><div class="tip-dim" style="color:var(--color-accent);">${s.dim.name}</div><div class="tip-text">${s.text}</div></div>`;
    });
  }

  if (gaps.length > 0) {
    html += `<h4 style="font-size:0.9rem;margin:16px 0 8px;color:var(--color-primary);font-family:var(--font-heading);">Where you differ</h4>`;
    gaps.forEach(g => {
      html += `<div class="gap-card"><div class="gap-dim-name">${g.dim.name} (${g.diff > 0 ? '+' : ''}${g.diff} points)</div><div class="gap-text">${g.text}</div></div>`;
    });
  }

  if (gaps.length === 0 && similarities.length > 0) {
    html += `<p style="color:var(--color-text-muted);font-size:0.9rem;margin-top:12px;">No major cultural gaps detected \u2014 you'd fit right in!</p>`;
  }
  html += `</div>`;
  container.innerHTML = html;
}

// ============================================================
// COUNTRY DETAIL MODAL
// ============================================================
function openCountryModal(country) {
  const overlay = document.getElementById('modal-overlay');
  const header = document.getElementById('modal-header');
  const body = document.getElementById('modal-body');
  const keys = ['pdi', 'idv', 'mas', 'uai', 'lto', 'ivr'];

  header.innerHTML = `
    <span class="modal-flag">${getFlag(country.code)}</span>
    <div class="modal-info">
      <h2>${country.name}</h2>
      <span class="modal-pct">${country.matchPct}% cultural match</span>
    </div>
    <button class="modal-close" id="modal-close-btn">&times;</button>
  `;

  // Comparison bars
  let html = `<div class="comparison-section"><h3>Your Scores vs ${country.name}</h3>`;
  html += `<div class="comp-legend"><span class="legend-you">You</span><span class="legend-country">${country.name}</span></div>`;

  keys.forEach(k => {
    const dim = DIMENSIONS.find(d => d.key === k);
    const uv = state.scores[k];
    const cv = country[k];
    if (cv === null || cv === undefined) return;
    const diff = Math.abs(uv - cv);
    const diffClass = diff > 15 ? 'large-gap' : 'small-gap';
    html += `
      <div class="comp-row">
        <div class="comp-label">
          <span>${dim.name}</span>
          <span class="comp-diff ${diffClass}">${diff === 0 ? 'Same' : (uv > cv ? '+' : '-') + diff}</span>
        </div>
        <div class="comp-bar-track"><div class="comp-bar-fill user-bar" style="width:${uv}%"></div></div>
        <div class="comp-bar-track"><div class="comp-bar-fill country-bar" style="width:${Math.min(cv, 100)}%"></div></div>
      </div>`;
  });
  html += '</div>';

  // Similarities and differences
  const similarities = [];
  const gaps = [];
  keys.forEach(k => {
    const dim = DIMENSIONS.find(d => d.key === k);
    const uv = state.scores[k];
    const cv = country[k];
    if (cv === null || cv === undefined) return;
    const diff = uv - cv;
    const absDiff = Math.abs(diff);
    if (absDiff <= 15) {
      const level = cv > 60 ? 'high' : cv < 40 ? 'low' : 'moderate';
      let simText = '';
      if (level === 'high') simText = `You both score high on ${dim.name.toLowerCase()}, valuing ${dim.highLabel.toLowerCase()} approaches.`;
      else if (level === 'low') simText = `You both lean toward ${dim.lowLabel.toLowerCase()} values in ${dim.name.toLowerCase()}.`;
      else simText = `You share a balanced, moderate view on ${dim.name.toLowerCase()}.`;
      similarities.push({ dim, text: simText });
    } else {
      gaps.push({ dim, diff, text: diff > 0 ? dim.gapText.higher : dim.gapText.lower });
    }
  });

  if (similarities.length > 0) {
    html += `<h3 class="section-heading">Where You're Similar</h3>`;
    similarities.forEach(s => {
      html += `<div class="tip-card" style="border-left-color:var(--color-accent);"><div class="tip-dim" style="color:var(--color-accent);">${s.dim.name}</div><div class="tip-text">${s.text}</div></div>`;
    });
  }

  if (gaps.length > 0) {
    html += `<h3 class="section-heading" style="margin-top:16px;">Where You Differ</h3>`;
    gaps.forEach(g => {
      html += `<div class="gap-card"><div class="gap-dim-name">${g.dim.name}</div><div class="gap-text">${g.text}</div></div>`;
    });
  }

  // Travel tips
  html += `<h3 class="section-heading" style="margin-top:20px;">&#9992;&#65039; If You're Visiting ${country.name}</h3>`;
  let hasTips = false;

  keys.forEach(k => {
    const dim = DIMENSIONS.find(d => d.key === k);
    const uv = state.scores[k];
    const cv = country[k];
    if (cv === null || cv === undefined) return;
    const diff = uv - cv;
    if (Math.abs(diff) > 10) {
      const tips = diff > 0 ? dim.travelTips.higher : dim.travelTips.lower;
      const numTips = Math.abs(diff) > 30 ? 2 : 1;
      tips.slice(0, numTips).forEach(tip => {
        hasTips = true;
        html += `<div class="tip-card"><div class="tip-dim">${dim.name}</div><div class="tip-text">${tip}</div></div>`;
      });
    }
  });

  if (!hasTips) {
    html += `<p style="color:var(--color-text-muted);font-size:0.9rem;">This country's culture is very similar to your values! You should feel right at home.</p>`;
  }

  body.innerHTML = html;
  overlay.classList.add('open');

  document.getElementById('modal-close-btn').addEventListener('click', closeModal);
  overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });
}

// ============================================================
// PERSON COMPARE MODAL
// ============================================================
function openPersonCompareModal(personName, personScores) {
  const overlay = document.getElementById('modal-overlay');
  const header = document.getElementById('modal-header');
  const body = document.getElementById('modal-body');
  const keys = ['pdi', 'idv', 'mas', 'uai', 'lto', 'ivr'];
  const youName = state.playerName || 'You';

  header.innerHTML = `
    <div class="modal-info" style="flex:1;">
      <h2>${youName} vs ${personName}</h2>
      <span class="modal-pct">Personal comparison</span>
    </div>
    <button class="modal-close" id="modal-close-btn">&times;</button>
  `;

  let html = `<div class="comparison-section"><h3>Score Comparison</h3>`;
  html += `<div class="comp-legend"><span class="legend-you">${youName}</span><span class="legend-person">${personName}</span></div>`;

  const gaps = [];

  keys.forEach(k => {
    const dim = DIMENSIONS.find(d => d.key === k);
    const uv = state.scores[k];
    const pv = personScores[k];
    const diff = Math.abs(uv - pv);
    const diffClass = diff > 15 ? 'large-gap' : 'small-gap';
    html += `
      <div class="comp-row">
        <div class="comp-label">
          <span>${dim.name}</span>
          <span class="comp-diff ${diffClass}">${diff === 0 ? 'Same' : (uv > pv ? '+' : '-') + diff}</span>
        </div>
        <div class="comp-bar-track"><div class="comp-bar-fill user-bar" style="width:${uv}%"></div></div>
        <div class="comp-bar-track"><div class="comp-bar-fill person-bar" style="width:${pv}%"></div></div>
      </div>`;

    if (diff > 15) {
      const direction = uv > pv ? 'higher' : 'lower';
      let insight = '';
      if (dim.key === 'pdi') insight = direction === 'higher' ? `${youName} values hierarchy more, while ${personName} is more egalitarian.` : `${personName} values hierarchy more, while ${youName} is more egalitarian.`;
      else if (dim.key === 'idv') insight = direction === 'higher' ? `${youName} is more independent-minded, while ${personName} is more group-oriented.` : `${personName} is more independent-minded, while ${youName} is more group-oriented.`;
      else if (dim.key === 'mas') insight = direction === 'higher' ? `${youName} is more competitive and achievement-driven, while ${personName} values caring and cooperation more.` : `${personName} is more competitive and achievement-driven, while ${youName} values caring and cooperation more.`;
      else if (dim.key === 'uai') insight = direction === 'higher' ? `${youName} prefers more structure and certainty, while ${personName} is more comfortable with ambiguity.` : `${personName} prefers more structure and certainty, while ${youName} is more comfortable with ambiguity.`;
      else if (dim.key === 'lto') insight = direction === 'higher' ? `${youName} is more future-focused and pragmatic, while ${personName} is more tradition-oriented.` : `${personName} is more future-focused and pragmatic, while ${youName} is more tradition-oriented.`;
      else if (dim.key === 'ivr') insight = direction === 'higher' ? `${youName} is more indulgent and fun-loving, while ${personName} is more restrained and duty-focused.` : `${personName} is more indulgent and fun-loving, while ${youName} is more restrained and duty-focused.`;
      gaps.push({ dim, insight });
    }
  });

  html += '</div>';

  if (gaps.length > 0) {
    html += `<h3 class="section-heading">Where You Differ</h3>`;
    gaps.forEach(g => {
      html += `<div class="gap-card"><div class="gap-dim-name">${g.dim.name}</div><div class="gap-text">${g.insight}</div></div>`;
    });
  } else {
    html += `<p style="color:var(--color-text-muted);font-size:0.9rem;margin-top:12px;">You two are remarkably similar! No major cultural differences found.</p>`;
  }

  body.innerHTML = html;
  overlay.classList.add('open');

  document.getElementById('modal-close-btn').addEventListener('click', closeModal);
  overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}

// ============================================================
// EVENT LISTENERS
// ============================================================
document.getElementById('btn-start').addEventListener('click', () => {
  const nameEl = document.getElementById('name-input');
  const errorEl = document.getElementById('name-error');
  const name = nameEl.value.trim();
  if (!name) {
    nameEl.classList.add('error');
    errorEl.textContent = 'Please enter your name to continue';
    nameEl.focus();
    setTimeout(() => nameEl.classList.remove('error'), 500);
    return;
  }
  errorEl.textContent = '';
  state.playerName = name;
  document.title = name + ' \u2014 What Country Are You?';
  navigateTo(1);
});

// Allow Enter key on name input
document.getElementById('name-input').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') document.getElementById('btn-start').click();
});

// Clear error on typing
document.getElementById('name-input').addEventListener('input', () => {
  document.getElementById('name-error').textContent = '';
});

document.addEventListener('click', (e) => {
  if (e.target.classList.contains('btn-next')) {
    if (state.currentScreen >= 1 && state.currentScreen <= 5) {
      navigateTo(state.currentScreen + 1);
    } else if (state.currentScreen === 6) {
      computeResults();
      navigateTo(7);
      renderResults();
    }
  }
  if (e.target.classList.contains('btn-back')) {
    if (state.currentScreen > 0) navigateTo(state.currentScreen - 1);
  }
});

// Slider handling
document.querySelectorAll('.custom-slider').forEach(slider => {
  slider.addEventListener('input', (e) => {
    const dim = e.target.dataset.dim;
    const val = parseInt(e.target.value);
    state.scores[dim] = val;
    e.target.style.setProperty('--val', val + '%');
  });
});

// Importance toggle handling (event delegation)
document.addEventListener('click', (e) => {
  if (!e.target.classList.contains('imp-btn')) return;
  const btnGroup = e.target.closest('.importance-btns');
  if (!btnGroup) return;
  const dim = btnGroup.dataset.dim;
  const weight = parseFloat(e.target.dataset.weight);
  state.weights[dim] = weight;
  btnGroup.querySelectorAll('.imp-btn').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');
});

// Close modal on Escape
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
</script>
</body>
</html>
